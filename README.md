# Sample Unity Project with External Libraries

## Overview

This project is a demonstration of how to develop Unity games using Visual Studio that also include external libraries.

As mentioned earlier, we favor distributing source for shared libraries to our internal developers. We also favor performing unit tests on our libraries. Unit testing requires that we have separate unit test projects included in our solutions but that the unit test project libraries do not get included in the game. We also want to be able to develop our libraries independently of Unity, minimizing any dependency on the engine for shared code.

To make libraries testable, they are stored in VS projects outside the Unity root. The assemblies produced by these libraries are copied in a post-build step into `Assets/Binaries`.

## Project Structure (partial)

```
VCS Root/Unity Root
|- <project>.sln 				Visual Studio solution for Unity project. Can be edited in VS.
|- <project>.CSharp.csproj		Autogenerated project file for Unity .cs scripts. Don't edit.
|- <project>.userprefs			Visual Studio project preferences
|- Assets						Unity directory for developer content
|--| Binaries					Output directory for DLLs for libraries
|- Libraries 					Mobilityware standard folder for custom libraries
|--| lib_unity_<name>			Mobilityware custom library top-level folder
|----| <project>				Class library project
|------| <project>.csproj		Project file for the class library
|----| <project>.Tests 			Unit tests for class library project
|------| <project>.Tests.csproj		Project file for the tests for the class library
|- Temp							Unity standard temp folder where test libraries are output
|--| bin/Debug					Folder for debug versions of libraries not included in Unity project
|--| bin/Release				Folder for release versions of libraries not included in Unity project
|- packages						NuGet directory for downloaded packages like NUnit
```

## Assumptions

You don't write `MonoBehaviours` in libraries!

`MonoBehaviours` are not unit testable. You cannot instantiate them directly. Rather than wrestle with this fact, accept it and simply avoid putting functionality into them. Instead, use something like the MVC pattern for Unity proposed [here](http://www.slideshare.net/paytonrules/tdd-in-unity?next_slideshow=1) and remove as much of the logic from your `MonoBehaviours` as possible and abstract them to libraries.

## Setting up your Visual Studio Library project

* For library (not test project) 
	* Create a C# class library
	* Set the target of the library to Unit 3.5 .net Subset
	* Add a post build step to copy the DLL (see below)
	* Set the target for Unity 3.5 subset
* For NUnit test project
	* Create the project from one of the "create project" menus, not the "add unit tests" menus
	* Create it using the NUnit 3 template
	* Name it <project>.Tests and place it in the same directory as <project>
	* Set the target for .NET 4.5
* Use the included MW Unity .gitignore file

```xml
  <PropertyGroup>
    <PostBuildEvent Condition=" '$(OS)' == 'Unix' ">cp -R "$(TargetDir)/*" "$(SolutionDir)/Assets/Libraries"</PostBuildEvent>
    <PostBuildEvent Condition=" '$(OS)' != 'Unix' ">xcopy "$(TargetDir)*" "$(SolutionDir)Assets\Libraries" /Y /E /I</PostBuildEvent>
  </PropertyGroup>
```